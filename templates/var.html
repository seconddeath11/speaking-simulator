{% extends 'base.html' %}
{% block title %} {{task.num}} {% endblock %}
{% block content %}
<script src="{{ url_for('static', filename='js/lazysizes.min.js')}}" async></script>
<div class="container headers"><h1>Task {{task.num}} {%if ans_time%} - Question {{ans_time}} {%endif%}</h1>

        </div>
<div class="container line"></div>
<div class="container content">


{% if task.info %}
    <p><b>{{task.info}}</b></p>

{% endif %}

{% if not(task.picture2) and task.picture1 %}
<div class="pics">
<img src="{{ url_for('static', filename=task.picture1) }}" alt="" class="lazyload">
</div>
{% endif %}

{% if task.text %}
    <p>
{% for text in task.text %}

{{text}}<br>

{%endfor%}
    </p>
{% endif %}
{% if task.outro %}
<p>
    <b>{{task.outro}}</b></p>
{% endif %}
{% if task.picture2 and task.picture1 %}
<div class="pics">
<img src="{{ url_for('static', filename=task.picture1) }}" alt="" class="lazyload">
<img src="{{ url_for('static', filename=task.picture2) }}" alt="" class="lazyload">
</div>
{% endif %}
{% if task.audio %}
<audio controls id="audio" preload="metadata">
  <source src="{{ url_for('static', filename=task.audio) }}" type="audio/mpeg">
</audio>
{% endif %}
</div>
<button onclick="redirect()">dddd</button>
<div class="footer">
  <div class="container foot">
      {% if prep == 1 %}<h4>Preparation</h4>{% else %}<h4>Answer</h4>{% endif %}
      <div class="progress">
  <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="{% if prep == 1 %}{{task.prep_time}}{% else %}{{task.answer_time}}{% endif %}"></div>
</div>
    <h4 id="time"></h4>
  </div>

</div>

<script>

function redirect() {
     window.location.href = "{{next}}";
}

function startTimer() {
    var elem = document.querySelector(".progress-bar");
var width = -1;
var duration = {% if prep == 1 %}{{task.prep_time}}{% else %}{{task.answer_time}}{% endif %},
        display = document.querySelector('#time');
if ({{task.num}} == 3){
 au = document.getElementById("audio");
 au.load();
au.onloadeddata = function() {

     document.getElementById("audio").play();

};
}
var timer = duration;
    display.innerHTML = formatTime(duration);

    setInterval(function () {
        display.innerHTML = formatTime(timer);
        width += 1 / duration * 100;
        elem.style.width = width + "%";
        if (--timer < 0) {
            if ({{prep}} == 1){
            {%set prep = 0%}}
            redirect();
        }
    }, 1000);



}
function formatTime(time) {
  const minutes = Math.floor(time / 60);
  let seconds = time % 60;
  if (seconds < 10) {
    seconds = `0${seconds}`;
  }
  return `${minutes}:${seconds}`;
}

startTimer();
</script>
{% endblock %}
